define("wiki-common:widget/lib/jsmart/jsmart",function(require,exports,module){function obMerge(e){for(var r=1;r<arguments.length;++r)for(var t in arguments[r])e[t]=arguments[r][t];return e}function countProperties(e){var r=0;for(var t in e)e.hasOwnProperty(t)&&r++;return r}function findInArray(e,r){if(Array.prototype.indexOf)return e.indexOf(r);for(var t=0;t<e.length;++t)if(e[t]===r)return t;return-1}function evalString(e){return e.replace(/\\t/,"	").replace(/\\n/,"\n").replace(/\\(['"\\])/g,"$1")}function trimQuotes(e){return evalString(e.replace(/^['"](.*)['"]$/,"$1")).replace(/^\s+|\s+$/g,"")}function findTag(e,r){for(var t=0,a=0,n=jSmart.prototype.left_delimiter,s=jSmart.prototype.right_delimiter,i=jSmart.prototype.auto_literal,o=/^\s*(.+)\s*$/i,p=e?new RegExp("^\\s*("+e+")\\s*$","i"):o,l=0;l<r.length;++l)if(r.substr(l,n.length)==n){if(i&&l+1<r.length&&r.substr(l+1,1).match(/\s/))continue;t||(r=r.slice(l),a+=parseInt(l),l=0),++t}else if(r.substr(l,s.length)==s){if(i&&l-1>=0&&r.substr(l-1,1).match(/\s/))continue;if(!--t){var c=r.slice(n.length,l).replace(/[\r\n]/g," "),u=c.match(p);if(u)return u.index=a,u[0]=r.slice(0,l+s.length),u}0>t&&(t=0)}return null}function findCloseTag(e,r,t){var a="",n=null,s=null,i=0;do{if(n&&(i+=n[0].length),n=findTag(e,t),!n)throw new Error("Unclosed {"+r+"}");a+=t.slice(0,n.index),i+=n.index,t=t.slice(n.index+n[0].length),s=findTag(r,a),s&&(a=a.slice(s.index+s[0].length))}while(s);return n.index=i,n}function findElseTag(e,r,t,a){for(var n=0,s=findTag(t,a);s;s=findTag(t,a)){var i=findTag(e,a);if(!i||i.index>s.index)return s.index+=n,s;a=a.slice(i.index+i[0].length),n+=i.index+i[0].length;var o=findCloseTag(r,e,a);a=a.slice(o.index+o[0].length),n+=o.index+o[0].length}return null}function execute(code,data){if("string"==typeof code)with({__code:code})with(modifiers)with(data)try{return eval(__code)}catch(e){throw new Error(e.message+" in \n"+code)}return code}function assignVar(e,r,t){e.match(/\[\]$/)?t[e.replace(/\[\]$/,"")].push(r):t[e]=r}function parse(e,r){for(var t=findTag("",e);t;t=findTag("",e)){t.index&&parseText(e.slice(0,t.index),r),e=e.slice(t.index+t[0].length);var a=t[1].match(/^\s*(\w+)(.*)$/);if(a){var n=a[1],s=a.length>2?a[2].replace(/^\s+|\s+$/g,""):"";if(n in buildInFunctions){var i=buildInFunctions[n],o=("parseParams"in i?i.parseParams:parseParams)(s);if("block"==i.type){e=e.replace(/^\n/,"");var p=findCloseTag("/"+n,n+" +[^}]*",e);i.parse(o,r,e.slice(0,p.index)),e=e.slice(p.index+p[0].length)}else i.parse(o,r),"extends"==n&&(r=[]);e=e.replace(/^\n/,"")}else if(n in plugins){var l=plugins[n];if("block"==l.type){var p=findCloseTag("/"+n,n+" +[^}]*",e);parsePluginBlock(n,parseParams(s),r,e.slice(0,p.index)),e=e.slice(p.index+p[0].length)}else"function"==l.type&&parsePluginFunc(n,parseParams(s),r);("append"==n||"assign"==n||"capture"==n||"eval"==n||"include"==n)&&(e=e.replace(/^\n/,""))}else buildInFunctions.expression.parse(t[1],r)}else{var c=buildInFunctions.expression.parse(t[1],r);"build-in"==c.type&&"operator"==c.name&&"="==c.op&&(e=e.replace(/^\n/,""))}}return e&&parseText(e,r),r}function parseText(e,r){if(parseText.parseEmbeddedVars)for(var t=/([$][\w@]+)|`([^`]*)`/,a=t.exec(e);a;a=t.exec(e))r.push({type:"text",data:e.slice(0,a.index)}),r.push(parseExpression(a[1]?a[1]:a[2]).tree),e=e.slice(a.index+a[0].length);return r.push({type:"text",data:e}),r}function parseFunc(e,r,t){return r.__parsed.name=parseText(e,[])[0],t.push({type:"plugin",name:"__func",params:r}),t}function parseOperator(e,r,t,a){a.push({type:"build-in",name:"operator",op:e,optype:r,precedence:t,params:{}})}function parseVar(e,r,t){for(var a=r.token,n=[{type:"text",data:t.replace(/^(\w+)@(key|index|iteration|first|last|show|total)/gi,"$1__$2")}],s=/^(?:\.|\s*->\s*|\[\s*)/,i=e.match(s);i;i=e.match(s)){r.token+=i[0],e=e.slice(i[0].length);var o={value:"",tree:[]};if(i[0].match(/\[/)){o=parseExpression(e),o&&(r.token+=o.value,n.push(o.tree),e=e.slice(o.value.length));var p=e.match(/\s*\]/);p&&(r.token+=p[0],e=e.slice(p[0].length))}else{var l=parseModifiers.stop;if(parseModifiers.stop=!0,lookUp(e,o)){r.token+=o.value;var c=o.tree[0];"plugin"==c.type&&"__func"==c.name&&(c.hasOwner=!0),n.push(c),e=e.slice(o.value.length)}else o=!1;parseModifiers.stop=l}o||n.push({type:"text",data:""})}return r.tree.push({type:"var",parts:n}),r.value+=r.token.substr(a.length),onParseVar(r.token),e}function onParseVar(){}function parseModifiers(e,r){if(!parseModifiers.stop){var t=e.match(/^\|(\w+)/);if(t){r.value+=t[0];var a="default"==t[1]?"defaultValue":t[1];e=e.slice(t[0].length).replace(/^\s+/,""),parseModifiers.stop=!0;for(var n=[],s=e.match(/^\s*:\s*/);s;s=e.match(/^\s*:\s*/)){r.value+=e.slice(0,s[0].length),e=e.slice(s[0].length);var i={value:"",tree:[]};lookUp(e,i)?(r.value+=i.value,n.push(i.tree[0]),e=e.slice(i.value.length)):parseText("",n)}parseModifiers.stop=!1,n.unshift(r.tree.pop()),r.tree.push(parseFunc(a,{__parsed:n},[])[0]),parseModifiers(e,r)}}}function lookUp(e,r){if(!e)return!1;if(e.substr(0,jSmart.prototype.left_delimiter.length)==jSmart.prototype.left_delimiter){var t=findTag("",e);if(t)return r.token=t[0],r.value+=t[0],parse(t[0],r.tree),parseModifiers(e.slice(r.value.length),r),!0}for(var a=0;a<tokens.length;++a)if(e.match(tokens[a].re))return r.token=RegExp.lastMatch,r.value+=RegExp.lastMatch,tokens[a].parse(r,e.slice(r.token.length)),!0;return!1}function bundleOp(e,r,t){var a=r[e];if("operator"==a.name&&a.precedence==t&&!a.params.__parsed){if("binary"==a.optype)return a.params.__parsed=[r[e-1],r[e+1]],r.splice(e-1,3,a),!0;if("post-unary"==a.optype)return a.params.__parsed=[r[e-1]],r.splice(e-1,2,a),!0;a.params.__parsed=[r[e+1]],r.splice(e,2,a)}return!1}function composeExpression(e){var r=0;for(r=0;r<e.length;++r)e[r]instanceof Array&&(e[r]=composeExpression(e[r]));for(var t=1;14>t;++t)if(2==t||10==t)for(r=e.length;r>0;--r)r-=bundleOp(r-1,e,t);else for(r=0;r<e.length;++r)r-=bundleOp(r,e,t);return e[0]}function parseExpression(e){for(var r={value:"",tree:[]};lookUp(e.slice(r.value.length),r););return r.tree.length?(r.tree=composeExpression(r.tree),r):!1}function parseParams(e,r,t){var a=e.replace(/\n/g," ").replace(/^\s+|\s+$/g,""),n=[];n.__parsed=[];var e="";if(!a)return n;for(r||(r=/^\s+/,t=/^(\w+)\s*=\s*/);a;){var s=null;if(t){var i=a.match(t);i&&(s=trimQuotes(i[1]),e+=a.slice(0,i[0].length),a=a.slice(i[0].length))}var o=parseExpression(a);if(!o)break;s?(n[s]=o.value,n.__parsed[s]=o.tree):(n.push(o.value),n.__parsed.push(o.tree)),e+=a.slice(0,o.value.length),a=a.slice(o.value.length);var p=a.match(r);if(!p)break;e+=a.slice(0,p[0].length),a=a.slice(p[0].length)}return n.toString=function(){return e},n}function parsePluginBlock(e,r,t,a){t.push({type:"plugin",name:e,params:r,subTree:parse(a,[])})}function parsePluginFunc(e,r,t){t.push({type:"plugin",name:e,params:r})}function getActualParamValues(e,r){var t=[];for(var a in e.__parsed)if(e.__parsed.hasOwnProperty(a)){var n=process([e.__parsed[a]],r);t[a]=n}return t.__get=function(e,r,a){if(e in t&&"undefined"!=typeof t[e])return t[e];if("undefined"!=typeof a&&"undefined"!=typeof t[a])return t[a];if(null===r)throw new Error("The required attribute '"+e+"' is missing");return r},t}function getVarValue(e,r,t){for(var a=r,n="",s=0;s<e.parts.length;++s){var i=e.parts[s];if("plugin"==i.type&&"__func"==i.name&&i.hasOwner)r.__owner=a,a=process([e.parts[s]],r),delete r.__owner;else if(n=process([i],r),n in r.smarty.section&&"text"==i.type&&"smarty"!=process([e.parts[0]],r)&&(n=r.smarty.section[n].index),!n&&"undefined"!=typeof t&&a instanceof Array&&(n=a.length),"undefined"!=typeof t&&s==e.parts.length-1&&(a[n]=t),"object"==typeof a&&null!==a&&n in a)a=a[n];else{if("undefined"==typeof t)return t;a[n]={},a=a[n]}}return a}function process(e,r){for(var t="",a=0;a<e.length;++a){var n="",s=e[a];if("text"==s.type)n=s.data;else if("var"==s.type)n=getVarValue(s,r);else if("build-in"==s.type)n=buildInFunctions[s.name].process(s,r);else if("plugin"==s.type){var i=plugins[s.name];if("block"==i.type){var o={value:!0};for(i.process(getActualParamValues(s.params,r),"",r,o);o.value;)o.value=!1,n+=i.process(getActualParamValues(s.params,r),process(s.subTree,r),r,o)}else"function"==i.type&&(n=i.process(getActualParamValues(s.params,r),r))}if("boolean"==typeof n&&(n=n?"1":""),1==e.length)return n;if(t+=n,r.smarty["continue"]||r.smarty["break"])return t}return t}function getTemplate(e,r,t){if(!t&&e in files)r=files[e];else{var a=jSmart.prototype.getTemplate(e);if("string"!=typeof a)throw new Error("No template for "+e);parse(applyFilters(jSmart.prototype.filters_global.pre,stripComments(a.replace(/\r\n/g,"\n"))),r),files[e]=r}return r}function stripComments(e){for(var r="",t=e.match(/{\*/);t;t=e.match(/{\*/)){r+=e.slice(0,t.index),e=e.slice(t.index+t[0].length);var a=e.match(/\*}/);if(!a)throw new Error("Unclosed {*");e=e.slice(a.index+a[0].length)}return r+e}function applyFilters(e,r){for(var t=0;t<e.length;++t)r=e[t](r);return r}var PHP_JS=require("wiki-common:widget/lib/jsmart/PHPJS"),buildInFunctions={expression:{parse:function(e,r){var t=parseExpression(e);return r.push({type:"build-in",name:"expression",expression:t.tree,params:parseParams(e.slice(t.value.length).replace(/^\s+|\s+$/g,""))}),t.tree},process:function(e,r){var t=getActualParamValues(e.params,r),a=process([e.expression],r);if(findInArray(t,"nofilter")<0){for(var n=0;n<default_modifiers.length;++n){var s=default_modifiers[n];s.params.__parsed[0]={type:"text",data:a},a=process([s],r)}escape_html&&(a=modifiers.escape(a)),a=applyFilters(varFilters,a),tpl_modifiers.length&&(__t=function(){return a},a=process(tpl_modifiers,r))}return a}},operator:{process:function(e,r){var t=getActualParamValues(e.params,r),a=t[0];if("binary"!=e.optype){if("!"==e.op)return!a;var n="var"==e.params.__parsed[0].type;n&&(a=getVarValue(e.params.__parsed[0],r));var s=a;if("pre-unary"==e.optype){switch(e.op){case"-":s=-a;break;case"++":s=++a;break;case"--":s=--a}n&&getVarValue(e.params.__parsed[0],r,a)}else{switch(e.op){case"++":a++;break;case"--":a--}getVarValue(e.params.__parsed[0],r,a)}return s}var i=t[1];if("="==e.op)return getVarValue(e.params.__parsed[0],r,i),"";if(e.op.match(/(\+=|-=|\*=|\/=|%=)/)){switch(a=getVarValue(e.params.__parsed[0],r),e.op){case"+=":a+=i;break;case"-=":a-=i;break;case"*=":a*=i;break;case"/=":a/=i;break;case"%=":a%=i}return getVarValue(e.params.__parsed[0],r,a)}if(e.op.match(/div/))return"div"!=e.op^a%i==0;if(e.op.match(/even/))return"even"!=e.op^a/i%2==0;if(e.op.match(/xor/))return(a||i)&&!(a&&i);switch(e.op){case"==":return a==i;case"!=":return a!=i;case"+":return parseInt(a,10)+parseInt(i,10);case"-":return parseInt(a,10)-parseInt(i,10);case"*":return parseInt(a,10)*parseInt(i,10);case"/":return parseInt(a,10)/parseInt(i,10);case"%":return parseInt(a,10)%parseInt(i,10);case"&&":return a&&i;case"||":return a||i;case"<":return i>a;case"<=":return i>=a;case">":return a>i;case">=":return a>=i;case"===":return a===i;case"!==":return a!==i}}},section:{type:"block",parse:function(e,r,t){var a=[],n=[];r.push({type:"build-in",name:"section",params:e,subTree:a,subTreeElse:n});var s=findElseTag("section [^}]+","/section","sectionelse",t);s?(parse(t.slice(0,s.index),a),parse(t.slice(s.index+s[0].length).replace(/^[\r\n]/,""),n)):parse(t,a)},process:function(e,r){var t=getActualParamValues(e.params,r),a={};r.smarty.section[t.__get("name",null,0)]=a;var n=t.__get("show",!0);if(a.show=n,!n)return process(e.subTreeElse,r);var s=parseInt(t.__get("start",0)),i=t.loop instanceof Object?countProperties(t.loop):isNaN(t.loop)?0:parseInt(t.loop),o=parseInt(t.__get("step",1)),p=parseInt(t.__get("max"));isNaN(p)&&(p=Number.MAX_VALUE),0>s?(s+=i,0>s&&(s=0)):s>=i&&(s=i?i-1:0);for(var l=0,c=0,u=s;u>=0&&i>u&&p>l;u+=o,++l)c=u;a.total=l,a.loop=l,l=0;var m="";for(u=s;u>=0&&i>u&&p>l&&!r.smarty["break"];u+=o,++l)a.first=u==s,a.last=0>u+o||u+o>=i,a.index=u,a.index_prev=u-o,a.index_next=u+o,a.iteration=a.rownum=l+1,m+=process(e.subTree,r),r.smarty["continue"]=!1;return r.smarty["break"]=!1,l?m:process(e.subTreeElse,r)}},setfilter:{type:"block",parseParams:function(e){return[parseExpression("__t()|"+e).tree]},parse:function(e,r,t){r.push({type:"build-in",name:"setfilter",params:e,subTree:parse(t,[])})},process:function(e,r){tpl_modifiers=e.params;var t=process(e.subTree,r);return tpl_modifiers=[],t}},"for":{type:"block",parseParams:function(e){var r=e.match(/^\s*\$(\w+)\s*=\s*([^\s]+)\s*to\s*([^\s]+)\s*(?:step\s*([^\s]+))?\s*(.*)$/);if(!r)throw new Error("Invalid {for} parameters: "+e);return parseParams("varName='"+r[1]+"' from="+r[2]+" to="+r[3]+" step="+(r[4]?r[4]:"1")+" "+r[5])},parse:function(e,r,t){var a=[],n=[];r.push({type:"build-in",name:"for",params:e,subTree:a,subTreeElse:n});var s=findElseTag("for\\s[^}]+","/for","forelse",t);s?(parse(t.slice(0,s.index),a),parse(t.slice(s.index+s[0].length),n)):parse(t,a)},process:function(e,r){var t=getActualParamValues(e.params,r),a=parseInt(t.__get("from")),n=parseInt(t.__get("to")),s=parseInt(t.__get("step"));isNaN(s)&&(s=1);var i=parseInt(t.__get("max"));isNaN(i)&&(i=Number.MAX_VALUE);for(var o=0,p="",l=Math.min(Math.ceil(((s>0?n-a:a-n)+1)/Math.abs(s)),i),c=parseInt(t.from);l>o&&!r.smarty["break"];c+=s,++o)r[t.varName]=c,p+=process(e.subTree,r),r.smarty["continue"]=!1;return r.smarty["break"]=!1,o||(p=process(e.subTreeElse,r)),p}},"if":{type:"block",parse:function(e,r,t){var a=[],n=[];r.push({type:"build-in",name:"if",params:e,subTreeIf:a,subTreeElse:n});var s=findElseTag("if\\s+[^}]+","/if","else[^}]*",t);if(s){parse(t.slice(0,s.index),a),t=t.slice(s.index+s[0].length);var i=s[1].match(/^else\s*if(.*)/);i?buildInFunctions["if"].parse(parseParams(i[1]),n,t.replace(/^\n/,"")):parse(t.replace(/^\n/,""),n)}else parse(t,a)},process:function(e,r){return getActualParamValues(e.params,r)[0]?process(e.subTreeIf,r):process(e.subTreeElse,r)}},foreach:{type:"block",parseParams:function(e){var r=e.match(/^\s*([$].+)\s*as\s*[$](\w+)\s*(=>\s*[$](\w+))?\s*$/i);return r&&(e="from="+r[1]+" item="+(r[4]||r[2]),r[4]&&(e+=" key="+r[2])),parseParams(e)},parse:function(e,r,t){var a=[],n=[];r.push({type:"build-in",name:"foreach",params:e,subTree:a,subTreeElse:n});var s=findElseTag("foreach\\s[^}]+","/foreach","foreachelse",t);s?(parse(t.slice(0,s.index),a),parse(t.slice(s.index+s[0].length).replace(/^[\r\n]/,""),n)):parse(t,a)},process:function(e,r){var t=getActualParamValues(e.params,r),a=t.from;if(void 0==a)return"";a instanceof Object||(a=[a]);var n=countProperties(a);r[t.item+"__total"]=n,"name"in t&&(r.smarty.foreach[t.name]={},r.smarty.foreach[t.name].total=n);var s="",i=0;for(var o in a)if(a.hasOwnProperty(o)){if(r.smarty["break"])break;r[t.item+"__key"]=isNaN(o)?o:parseInt(o),"key"in t&&(r[t.key]=r[t.item+"__key"]),r[t.item]=a[o],r[t.item+"__index"]=parseInt(i),r[t.item+"__iteration"]=parseInt(i+1),r[t.item+"__first"]=0===i,r[t.item+"__last"]=i==n-1,"name"in t&&(r.smarty.foreach[t.name].index=parseInt(i),r.smarty.foreach[t.name].iteration=parseInt(i+1),r.smarty.foreach[t.name].first=0===i?1:"",r.smarty.foreach[t.name].last=i==n-1?1:""),++i,s+=process(e.subTree,r),r.smarty["continue"]=!1}return r.smarty["break"]=!1,r[t.item+"__show"]=i>0,t.name&&(r.smarty.foreach[t.name].show=i>0?1:""),i>0?s:process(e.subTreeElse,r)}},"function":{type:"block",parse:function(e,r,t){var a=[];plugins[trimQuotes(e.name?e.name:e[0])]={type:"function",subTree:a,defautParams:e,process:function(e,r){var t=getActualParamValues(this.defautParams,r);return delete t.name,process(this.subTree,obMerge({},r,t,e))}},parse(t,a)}},php:{type:"block",parse:function(){}},"extends":{type:"function",parse:function(e,r){r.splice(0,r.length),getTemplate(trimQuotes(e.file?e.file:e[0]),r)}},block:{type:"block",parse:function(e,r,t){r.push({type:"build-in",name:"block",params:e}),e.append=findInArray(e,"append")>=0,e.prepend=findInArray(e,"prepend")>=0,e.hide=findInArray(e,"hide")>=0,e.hasChild=e.hasParent=!1,onParseVar=function(r){r.match(/^\s*[$]smarty.block.child\s*$/)&&(e.hasChild=!0),r.match(/^\s*[$]smarty.block.parent\s*$/)&&(e.hasParent=!0)};var r=parse(t,[]);onParseVar=function(){};var a=trimQuotes(e.name?e.name:e[0]);a in blocks||(blocks[a]=[]),blocks[a].push({tree:r,params:e})},process:function(e,r){r.smarty.block.parent=r.smarty.block.child="";var t=trimQuotes(e.params.name?e.params.name:e.params[0]);return this.processBlocks(blocks[t],blocks[t].length-1,r),r.smarty.block.child},processBlocks:function(e,r,t){if(!r&&e[r].params.hide)return void(t.smarty.block.child="");for(var a=!0,n=!1;r>=0;--r){if(e[r].params.hasParent){var s=t.smarty.block.child;t.smarty.block.child="",this.processBlocks(e,r-1,t),t.smarty.block.parent=t.smarty.block.child,t.smarty.block.child=s}var s=t.smarty.block.child,i=process(e[r].tree,t);t.smarty.block.child=s,e[r].params.hasChild?t.smarty.block.child=i:a?t.smarty.block.child=i+t.smarty.block.child:n&&(t.smarty.block.child+=i),a=e[r].params.append,n=e[r].params.prepend}}},strip:{type:"block",parse:function(e,r,t){parse(t.replace(/[ \t]*[\r\n]+[ \t]*/g,""),r)}},literal:{type:"block",parse:function(e,r,t){parseText(t,r)}},ldelim:{type:"function",parse:function(e,r){parseText(jSmart.prototype.left_delimiter,r)}},rdelim:{type:"function",parse:function(e,r){parseText(jSmart.prototype.right_delimiter,r)}},"while":{type:"block",parse:function(e,r,t){r.push({type:"build-in",name:"while",params:e,subTree:parse(t,[])})},process:function(e,r){for(var t="";getActualParamValues(e.params,r)[0]&&!r.smarty["break"];)t+=process(e.subTree,r),r.smarty["continue"]=!1;return r.smarty["break"]=!1,t}}},plugins={},modifiers={},files={},blocks=null,scripts=null,tpl_modifiers=[],tokens=[{re:/^\$([\w@]+)/,parse:function(e,r){parseModifiers(parseVar(r,e,RegExp.$1),e)}},{re:/^(true|false)/i,parse:function(e){parseText(e.token.match(/true/i)?"1":"",e.tree)}},{re:/^'([^'\\]*(?:\\.[^'\\]*)*)'/,parse:function(e,r){parseText(evalString(RegExp.$1),e.tree),parseModifiers(r,e)}},{re:/^"([^"\\]*(?:\\.[^"\\]*)*)"/,parse:function(e,r){var t=evalString(RegExp.$1),a=t.match(tokens[0].re);if(a){var n={token:a[0],tree:[]};if(parseVar(t,n,a[1]),n.token.length==t.length)return void e.tree.push(n.tree[0])}parseText.parseEmbeddedVars=!0,e.tree.push({type:"plugin",name:"__quoted",params:{__parsed:parse(t,[])}}),parseText.parseEmbeddedVars=!1,parseModifiers(r,e)}},{re:/^(\w+)\s*[(]([)]?)/,parse:function(e,r){var t=RegExp.$1,a=RegExp.$2,n=parseParams(a?"":r,/^\s*,\s*/);parseFunc(t,n,e.tree),e.value+=n.toString(),parseModifiers(r.slice(n.toString().length),e)}},{re:/^\s*\(\s*/,parse:function(e){var r=[];e.tree.push(r),r.parent=e.tree,e.tree=r}},{re:/^\s*\)\s*/,parse:function(e){e.tree.parent&&(e.tree=e.tree.parent)}},{re:/^\s*(\+\+|--)\s*/,parse:function(e){e.tree.length&&"var"==e.tree[e.tree.length-1].type?parseOperator(RegExp.$1,"post-unary",1,e.tree):parseOperator(RegExp.$1,"pre-unary",1,e.tree)}},{re:/^\s*(===|!==|==|!=)\s*/,parse:function(e){parseOperator(RegExp.$1,"binary",6,e.tree)}},{re:/^\s+(eq|ne|neq)\s+/i,parse:function(e){var r=RegExp.$1.replace(/ne(q)?/,"!=").replace(/eq/,"==");parseOperator(r,"binary",6,e.tree)}},{re:/^\s*!\s*/,parse:function(e){parseOperator("!","pre-unary",2,e.tree)}},{re:/^\s+not\s+/i,parse:function(e){parseOperator("!","pre-unary",2,e.tree)}},{re:/^\s*(=|\+=|-=|\*=|\/=|%=)\s*/,parse:function(e){parseOperator(RegExp.$1,"binary",10,e.tree)}},{re:/^\s*(\*|\/|%)\s*/,parse:function(e){parseOperator(RegExp.$1,"binary",3,e.tree)}},{re:/^\s+mod\s+/i,parse:function(e){parseOperator("%","binary",3,e.tree)}},{re:/^\s*(\+|-)\s*/,parse:function(e){e.tree.length&&"operator"!=e.tree[e.tree.length-1].name?parseOperator(RegExp.$1,"binary",4,e.tree):parseOperator(RegExp.$1,"pre-unary",4,e.tree)}},{re:/^\s*(<=|>=|<>|<|>)\s*/,parse:function(e){parseOperator(RegExp.$1.replace(/<>/,"!="),"binary",5,e.tree)}},{re:/^\s+(lt|lte|le|gt|gte|ge)\s+/i,parse:function(e){var r=RegExp.$1.replace(/lt/,"<").replace(/l(t)?e/,"<=").replace(/gt/,">").replace(/g(t)?e/,">=");parseOperator(r,"binary",5,e.tree)}},{re:/^\s+(is\s+(not\s+)?div\s+by)\s+/i,parse:function(e){parseOperator(RegExp.$2?"div_not":"div","binary",7,e.tree)}},{re:/^\s+is\s+(not\s+)?(even|odd)(\s+by\s+)?\s*/i,parse:function(e){var r=RegExp.$1?"odd"==RegExp.$2?"even":"even_not":"odd"==RegExp.$2?"even_not":"even";parseOperator(r,"binary",7,e.tree),RegExp.$3||parseText("1",e.tree)}},{re:/^\s*(&&)\s*/,parse:function(e){parseOperator(RegExp.$1,"binary",8,e.tree)}},{re:/^\s*(\|\|)\s*/,parse:function(e){parseOperator(RegExp.$1,"binary",9,e.tree)}},{re:/^\s+and\s+/i,parse:function(e){parseOperator("&&","binary",11,e.tree)}},{re:/^\s+xor\s+/i,parse:function(e){parseOperator("xor","binary",12,e.tree)}},{re:/^\s+or\s+/i,parse:function(e){parseOperator("||","binary",13,e.tree)}},{re:/^#(\w+)#/,parse:function(e,r){var t={token:"$smarty",tree:[]};parseVar(".config."+RegExp.$1,t,"smarty"),e.tree.push(t.tree[0]),parseModifiers(r,e)}},{re:/^\s*\[\s*/,parse:function(e,r){var t=parseParams(r,/^\s*,\s*/,/^('[^'\\]*(?:\\.[^'\\]*)*'|"[^"\\]*(?:\\.[^"\\]*)*"|\w+)\s*=>\s*/);parsePluginFunc("__array",t,e.tree),e.value+=t.toString();var a=r.slice(t.toString().length).match(/\s*\]/);a&&(e.value+=a[0])}},{re:/^[\d.]+/,parse:function(e,r){e.token=e.token.indexOf(".")>-1?parseFloat(e.token):parseInt(e.token,10),parseText(e.token,e.tree),parseModifiers(r,e)}},{re:/^\w+/,parse:function(e,r){parseText(e.token,e.tree),parseModifiers(r,e)}}],jSmart=function(e){this.tree=[],this.tree.blocks={},this.scripts={},this.default_modifiers=[],this.filters={variable:[],post:[]},this.smarty={smarty:{block:{},"break":!1,capture:{},"continue":!1,counter:{},cycle:{},foreach:{},section:{},now:Math.floor((new Date).getTime()/1e3),"const":{},config:{},current_dir:"/",template:"",ldelim:jSmart.prototype.left_delimiter,rdelim:jSmart.prototype.right_delimiter,version:"2.13.1"}},blocks=this.tree.blocks,parse(applyFilters(jSmart.prototype.filters_global.pre,stripComments(new String(e?e:"").replace(/\|f_escape_\w+/g,"").replace(/\r\n/g,"\n"))),this.tree)};jSmart.prototype.fetch=function(e){blocks=this.tree.blocks,scripts=this.scripts,escape_html=this.escape_html,default_modifiers=jSmart.prototype.default_modifiers_global.concat(this.default_modifiers),this.data=obMerge("object"==typeof e?e:{},this.smarty),varFilters=jSmart.prototype.filters_global.variable.concat(this.filters.variable);var r=process(this.tree,this.data);return jSmart.prototype.debugging&&plugins.debug.process([],this.data),applyFilters(jSmart.prototype.filters_global.post.concat(this.filters.post),r)},jSmart.prototype.escape_html=!1,jSmart.prototype.registerPlugin=function(e,r,t){"modifier"==e?modifiers[r]=t:plugins[r]={type:e,process:t}},jSmart.prototype.registerFilter=function(e,r){(this.tree?this.filters:jSmart.prototype.filters_global)["output"==e?"post":e].push(r)},jSmart.prototype.filters_global={pre:[],variable:[],post:[]},jSmart.prototype.configLoad=function(e,r,t){t=t?t:this.data;for(var a=e.replace(/\r\n/g,"\n").replace(/^\s+|\s+$/g,""),n=/^\s*(?:\[([^\]]+)\]|(?:(\w+)[ \t]*=[ \t]*("""|'[^'\\\n]*(?:\\.[^'\\\n]*)*'|"[^"\\\n]*(?:\\.[^"\\\n]*)*"|[^\n]*)))/m,s="",i=a.match(n);i;i=a.match(n)){if(a=a.slice(i.index+i[0].length),i[1])s=i[1];else if((!s||s==r)&&"."!=s.substr(0,1))if('"""'==i[3]){var o=a.match(/"""/);o&&(t.smarty.config[i[2]]=a.slice(0,o.index),a=a.slice(o.index+o[0].length))}else t.smarty.config[i[2]]=trimQuotes(i[3]);var p=a.match(/\n+/);if(!p)break;a=a.slice(p.index+p[0].length)}},jSmart.prototype.clearConfig=function(e){e?delete this.data.smarty.config[e]:this.data.smarty.config={}},jSmart.prototype.addDefaultModifier=function(e){e instanceof Array||(e=[e]);for(var r=0;r<e.length;++r){var t={value:"",tree:[0]};parseModifiers("|"+e[r],t),(this.tree?this.default_modifiers:this.default_modifiers_global).push(t.tree[0])}},jSmart.prototype.default_modifiers_global=[],jSmart.prototype.getTemplate=function(e){return __inline(e)},jSmart.prototype.getFile=function(e){return __inline(e)},jSmart.prototype.getJavascript=function(e){return __inline(e)},jSmart.prototype.getConfig=function(e){return __inline(e)},jSmart.prototype.auto_literal=!0,jSmart.prototype.left_delimiter="{%",jSmart.prototype.right_delimiter="%}",jSmart.prototype.debugging=!1,jSmart.prototype.PHPJS=function(fnm,modifier){if("function"==eval("typeof "+fnm))return"object"==typeof window?window:global;if("function"==typeof PHP_JS)return new PHP_JS;throw new Error("Modifier '"+modifier+"' uses JavaScript port of PHP function '"+fnm+"'. You can find one at http://phpjs.org")},jSmart.prototype.makeTimeStamp=function(e){if(!e)return Math.floor((new Date).getTime()/1e3);if(isNaN(e)){var r=jSmart.prototype.PHPJS("strtotime","date_format").strtotime(e);return-1==r||r===!1?Math.floor((new Date).getTime()/1e3):r}return e=new String(e),14==e.length?Math.floor(new Date(e.substr(0,4),e.substr(4,2)-1,e.substr(6,2),e.substr(8,2),e.substr(10,2)).getTime()/1e3):parseInt(e)},jSmart.prototype.registerPlugin("function","__array",function(e){var r=[];for(var t in e)e.hasOwnProperty(t)&&e[t]&&"function"!=typeof e[t]&&(r[t]=e[t]);return r}),jSmart.prototype.registerPlugin("function","__func",function(e,r){for(var t=[],a={},n=0;n<e.length;++n)t.push(e.name+"__p"+n),a[e.name+"__p"+n]=e[n];var s="__owner"in r&&e.name in r.__owner?"__owner."+e.name:e.name;return execute(s+"("+t.join(",")+")",obMerge({},r,a))}),jSmart.prototype.registerPlugin("function","__quoted",function(e){return e.join("")}),jSmart.prototype.registerPlugin("function","append",function(e,r){var t=e.__get("var",null,0);t in r&&r[t]instanceof Array||(r[t]=[]);var a=e.__get("index",!1),n=e.__get("value",null,1);return a===!1?r[t].push(n):r[t][a]=n,""}),jSmart.prototype.registerPlugin("function","assign",function(e,r){return assignVar(e.__get("var",null,0),e.__get("value",null,1),r),""}),jSmart.prototype.registerPlugin("function","break",function(e,r){return r.smarty["break"]=!0,""}),jSmart.prototype.registerPlugin("function","call",function(e,r){var t=e.__get("name",null,0);delete e.name;var a=e.__get("assign",!1);delete e.assign;var n=plugins[t].process(e,r);return a?(assignVar(a,n,r),""):n}),jSmart.prototype.registerPlugin("block","capture",function(e,r,t){if(r){r=r.replace(/^\n/,""),t.smarty.capture[e.__get("name","default",0)]=r,"assign"in e&&assignVar(e.assign,r,t);var a=e.__get("append",!1);a&&(a in t?t[a]instanceof Array&&t[a].push(r):t[a]=[r])}return""}),jSmart.prototype.registerPlugin("function","continue",function(e,r){return r.smarty["continue"]=!0,""}),jSmart.prototype.registerPlugin("function","counter",function(e,r){var t=e.__get("name","default");if(t in r.smarty.counter){var a=r.smarty.counter[t];"start"in e?a.value=parseInt(e.start):(a.value=parseInt(a.value),a.skip=parseInt(a.skip),"down"==a.direction?a.value-=a.skip:a.value+=a.skip),a.skip=e.__get("skip",a.skip),a.direction=e.__get("direction",a.direction),a.assign=e.__get("assign",a.assign)}else r.smarty.counter[t]={value:parseInt(e.__get("start",1)),skip:parseInt(e.__get("skip",1)),direction:e.__get("direction","up"),assign:e.__get("assign",!1)};return r.smarty.counter[t].assign?(r[r.smarty.counter[t].assign]=r.smarty.counter[t].value,""):e.__get("print",!0)?r.smarty.counter[t].value:""}),jSmart.prototype.registerPlugin("function","cycle",function(e,r){var t=e.__get("name","default"),a=e.__get("reset",!1);t in r.smarty.cycle||(r.smarty.cycle[t]={arr:[""],delimiter:e.__get("delimiter",","),index:0},a=!0),e.__get("delimiter",!1)&&(r.smarty.cycle[t].delimiter=e.delimiter);var n=e.__get("values",!1);if(n){var s=[];if(n instanceof Object)for(nm in n)s.push(n[nm]);else s=n.split(r.smarty.cycle[t].delimiter);(s.length!=r.smarty.cycle[t].arr.length||s[0]!=r.smarty.cycle[t].arr[0])&&(r.smarty.cycle[t].arr=s,r.smarty.cycle[t].index=0,a=!0)}return e.__get("advance","true")&&(r.smarty.cycle[t].index+=1),(r.smarty.cycle[t].index>=r.smarty.cycle[t].arr.length||a)&&(r.smarty.cycle[t].index=0),e.__get("assign",!1)?(assignVar(e.assign,r.smarty.cycle[t].arr[r.smarty.cycle[t].index],r),""):e.__get("print",!0)?r.smarty.cycle[t].arr[r.smarty.cycle[t].index]:""}),jSmart.prototype.print_r=function(e,r){if(e instanceof Object){var t=(e instanceof Array?"Array["+e.length+"]":"Object")+"<br>";for(var a in e)e.hasOwnProperty(a)&&(t+=r+"&nbsp;&nbsp;<strong>"+a+"</strong> : "+jSmart.prototype.print_r(e[a],r+"&nbsp;&nbsp;&nbsp;")+"<br>");return t}return e},jSmart.prototype.registerPlugin("function","debug",function(e,r){"undefined"!=typeof dbgWnd&&dbgWnd.close(),dbgWnd=window.open("","","width=680,height=600,resizable,scrollbars=yes");var t="",a=0;for(var n in r)t+="<tr class="+(++a%2?"odd":"even")+"><td><strong>"+n+"</strong></td><td>"+jSmart.prototype.print_r(r[n],"")+"</td></tr>";return dbgWnd.document.write("                  <html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en'>                  <head>                   <title>jSmart Debug Console</title>                     <style type='text/css'>                        table {width: 100%;}                        td {vertical-align:top;width: 50%;}                        .even td {background-color: #fafafa;}                     </style>                  </head>                  <body>                     <h1>jSmart Debug Console</h1>                     <h2>assigned template variables</h2>                     <table>"+t+"</table>                  </body>                  </html>               "),""}),jSmart.prototype.registerPlugin("function","eval",function(e,r){var t=[];parse(e.__get("var","",0),t);var a=process(t,r);return"assign"in e?(assignVar(e.assign,a,r),""):a}),jSmart.prototype.registerPlugin("function","fetch",function(e,r){var t=jSmart.prototype.getFile(e.__get("file",null,0));return"assign"in e?(assignVar(e.assign,t,r),""):t}),jSmart.prototype.registerPlugin("function","html_checkboxes",function(e,r){var t,a,n,s=e.__get("type","checkbox"),i=e.__get("name",s),o=e.__get("name",s),p=e.__get("values",e.options),l=e.__get("options",[]),c="options"in e,u=e.__get("selected",!1),m=e.__get("separator",""),g=Boolean(e.__get("labels",!0)),f=Boolean(e.__get("label_ids",!1)),d=[],h=0,y="";if("checkbox"==s&&(i+="[]"),!c)for(t in e.output)l.push(e.output[t]);for(t in p)p.hasOwnProperty(t)&&(a=c?t:p[t],n=o+"_"+a,y=g?f?'<label for="'+n+'">':"<label>":"",y+='<input type="'+s+'" name="'+i+'" value="'+a+'" ',f&&(y+='id="'+n+'" '),u==(c?t:p[t])&&(y+='checked="checked" '),y+="/>"+l[c?t:h++],y+=g?"</label>":"",y+=m,d.push(y));return"assign"in e?(assignVar(e.assign,d,r),""):d.join("\n")}),jSmart.prototype.registerPlugin("function","html_image",function(e){var r,t=e.__get("file",null),a=e.__get("width",!1),n=e.__get("height",!1),s=e.__get("alt",""),i=e.__get("href",e.__get("link",!1)),o=e.__get("path_prefix",""),p={file:1,width:1,height:1,alt:1,href:1,basedir:1,path_prefix:1,link:1},l='<img src="'+o+t+'" alt="'+s+'"'+(a?' width="'+a+'"':"")+(n?' height="'+n+'"':"");for(r in e)e.hasOwnProperty(r)&&"string"==typeof e[r]&&(r in p||(l+=" "+r+'="'+e[r]+'"'));return l+=" />",i?'<a href="'+i+'">'+l+"</a>":l}),jSmart.prototype.registerPlugin("function","html_options",function(e){var r,t=e.__get("values",e.options),a=e.__get("options",[]),n="options"in e;if(!n)for(r in e.output)a.push(e.output[r]);var s=e.__get("selected",!1),i=[],o="",p=0;for(r in t)t.hasOwnProperty(r)&&(o='<option value="'+(n?r:t[r])+'"',s==(n?r:t[r])&&(o+=' selected="selected"'),o+=">"+a[n?r:p++]+"</option>",i.push(o));var l=e.__get("name",!1);return(l?'<select name="'+l+'">\n'+i.join("\n")+"\n</select>":i.join("\n"))+"\n"}),jSmart.prototype.registerPlugin("function","html_radios",function(e,r){return e.type="radio",plugins.html_checkboxes.process(e,r)}),jSmart.prototype.registerPlugin("function","html_select_date",function(e){var r=e.__get("prefix","Date_"),t=["January","February","March","April","May","June","July","August","September","October","November","December"],a="";a+='<select name="'+r+'Month">\n';var n=0;for(n=0;n<t.length;++n)a+='<option value="'+n+'">'+t[n]+"</option>\n";for(a+="</select>\n",a+='<select name="'+r+'Day">\n',n=0;31>n;++n)a+='<option value="'+n+'">'+n+"</option>\n";return a+="</select>\n"
}),jSmart.prototype.registerPlugin("function","html_table",function(e){var r,t=[];if(e.loop instanceof Array)t=e.loop;else for(r in e.loop)e.loop.hasOwnProperty(r)&&t.push(e.loop[r]);var a=e.__get("rows",!1),n=e.__get("cols",!1);n||(n=a?Math.ceil(t.length/a):3);var s=[];if(isNaN(n)){if("object"==typeof n)for(r in n)n.hasOwnProperty(r)&&s.push(n[r]);else s=n.split(/\s*,\s*/);n=s.length}a=a?a:Math.ceil(t.length/n);var i=e.__get("inner","cols"),o=e.__get("caption",""),p=e.__get("table_attr",'border="1"'),l=e.__get("th_attr",!1);l&&"object"!=typeof l&&(l=[l]);var c=e.__get("tr_attr",!1);c&&"object"!=typeof c&&(c=[c]);var u=e.__get("td_attr",!1);u&&"object"!=typeof u&&(u=[u]);for(var m=e.__get("trailpad","&nbsp;"),g=e.__get("hdir","right"),f=e.__get("vdir","down"),d="",h=0;a>h;++h){d+="<tr"+(c?" "+c[h%c.length]:"")+">\n";for(var y=0;n>y;++y){var _="cols"==i?("down"==f?h:a-1-h)*n+("right"==g?y:n-1-y):("right"==g?y:n-1-y)*a+("down"==f?h:a-1-h);d+="<td"+(u?" "+u[y%u.length]:"")+">"+(_<t.length?t[_]:m)+"</td>\n"}d+="</tr>\n"}var b="";if(s.length){b="\n<thead><tr>";for(var v=0;v<s.length;++v)b+="\n<th"+(l?" "+l[v%l.length]:"")+">"+s["right"==g?v:s.length-1-v]+"</th>";b+="\n</tr></thead>"}return"<table "+p+">"+(o?"\n<caption>"+o+"</caption>":"")+b+"\n<tbody>\n"+d+"</tbody>\n</table>\n"}),jSmart.prototype.registerPlugin("function","include",function(e,r){var t=e.__get("file",null,0),a=obMerge({},r,e);a.smarty.template=t;var n=process(getTemplate(t,[],findInArray(e,"nocache")>=0),a);return"assign"in e?(assignVar(e.assign,n,r),""):n}),jSmart.prototype.registerPlugin("function","include_javascript",function(e,r){var t=e.__get("file",null,0);if(e.__get("once",!0)&&t in scripts)return"";scripts[t]=!0;var a=execute(jSmart.prototype.getJavascript(t),{$this:r});return"assign"in e?(assignVar(e.assign,a,r),""):a}),jSmart.prototype.registerPlugin("function","include_php",function(e,r){return plugins.include_javascript.process(e,r)}),jSmart.prototype.registerPlugin("function","insert",function(params,data){var fparams={};for(var nm in params)params.hasOwnProperty(nm)&&isNaN(nm)&&params[nm]&&"string"==typeof params[nm]&&"name"!=nm&&"assign"!=nm&&"script"!=nm&&(fparams[nm]=params[nm]);var prefix="insert_";"script"in params&&(eval(jSmart.prototype.getJavascript(params.script)),prefix="smarty_insert_");var func=eval(prefix+params.__get("name",null,0)),s=func(fparams,data);return"assign"in params?(assignVar(params.assign,s,data),""):s}),jSmart.prototype.registerPlugin("block","javascript",function(e,r,t){return t.$this=t,execute(r,t),delete t.$this,""}),jSmart.prototype.registerPlugin("function","config_load",function(e,r){return jSmart.prototype.configLoad(jSmart.prototype.getConfig(e.__get("file",null,0)),e.__get("section","",1),r),""}),jSmart.prototype.registerPlugin("function","mailto",function(e){var r=e.__get("address",null),t=e.__get("encode","none"),a=e.__get("text",r),n=jSmart.prototype.PHPJS("rawurlencode","mailto").rawurlencode(e.__get("cc","")).replace("%40","@"),i=jSmart.prototype.PHPJS("rawurlencode","mailto").rawurlencode(e.__get("bcc","")).replace("%40","@"),o=jSmart.prototype.PHPJS("rawurlencode","mailto").rawurlencode(e.__get("followupto","")).replace("%40","@"),p=jSmart.prototype.PHPJS("rawurlencode","mailto").rawurlencode(e.__get("subject","")),l=jSmart.prototype.PHPJS("rawurlencode","mailto").rawurlencode(e.__get("newsgroups","")),c=e.__get("extra","");if(r+=n?"?cc="+n:"",r+=i?(n?"&":"?")+"bcc="+i:"",r+=p?(n||i?"&":"?")+"subject="+p:"",r+=l?(n||i||p?"&":"?")+"newsgroups="+l:"",r+=o?(n||i||p||l?"&":"?")+"followupto="+o:"",s='<a href="mailto:'+r+'" '+c+">"+a+"</a>","javascript"==t){s="document.write('"+s+"');";for(var u="",m=0;m<s.length;++m)u+="%"+jSmart.prototype.PHPJS("bin2hex","mailto").bin2hex(s.substr(m,1));return'<script type="text/javascript">eval(unescape(\''+u+"'))</script>"}if("javascript_charcode"==t){for(var g=[],m=0;m<s.length;++m)g.push(jSmart.prototype.PHPJS("ord","mailto").ord(s.substr(m,1)));return'<script type="text/javascript" language="javascript">\n<!--\n{document.write(String.fromCharCode('+g.join(",")+"))}\n//-->\n</script>\n"}if("hex"==t){if(r.match(/^.+\?.+$/))throw new Error("mailto: hex encoding does not work with extra attributes. Try javascript.");for(var f="",m=0;m<r.length;++m)f+=r.substr(m,1).match(/\w/)?"%"+jSmart.prototype.PHPJS("bin2hex","mailto").bin2hex(r.substr(m,1)):r.substr(m,1);for(var d="",m=0;m<a.length;++m)d+="&#x"+jSmart.prototype.PHPJS("bin2hex","mailto").bin2hex(a.substr(m,1))+";";return'<a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;'+f+'" '+c+">"+d+"</a>"}return s}),jSmart.prototype.registerPlugin("function","math",function(params,data){with(Math)with(params)var res=eval(params.__get("equation",null).replace(/pi\(\s*\)/g,"PI"));return"format"in params&&(res=jSmart.prototype.PHPJS("sprintf","math").sprintf(params.format,res)),"assign"in params?(assignVar(params.assign,res,data),""):res}),jSmart.prototype.registerPlugin("block","nocache",function(e,r){return r}),jSmart.prototype.registerPlugin("block","textformat",function(e,r,t){if(!r)return"";var a=e.__get("wrap",80),n=e.__get("wrap_char","\n"),s=e.__get("wrap_cut",!1),i=e.__get("indent_char"," "),o=e.__get("indent",0),p=new Array(o+1).join(i),l=e.__get("indent_first",0),c=new Array(l+1).join(i),u=e.__get("style","");"email"==u&&(a=72);for(var m=r.split(/[\r\n]{2}/),g=0;g<m.length;++g){var f=m[g];f&&(f=f.replace(/^\s+|\s+$/,"").replace(/\s+/g," "),l>0&&(f=c+f),f=modifiers.wordwrap(f,a-o,n,s),o>0&&(f=f.replace(/^/gm,p)),m[g]=f)}var d=m.join(n+n);return"assign"in e?(assignVar(e.assign,d,t),""):d}),jSmart.prototype.registerPlugin("modifier","capitalize",function(e,r){var t=new RegExp(r?"[\\W\\d]+":"\\W+"),a=null,n="";for(a=e.match(t);a;a=e.match(t)){var s=e.slice(0,a.index);n+=s.match(/\d/)?s:s.charAt(0).toUpperCase()+s.slice(1),n+=e.slice(a.index,a.index+a[0].length),e=e.slice(a.index+a[0].length)}return e.match(/\d/)?n+e:n+e.charAt(0).toUpperCase()+e.slice(1)}),jSmart.prototype.registerPlugin("modifier","cat",function(e,r){return r=r?r:"",e+r}),jSmart.prototype.registerPlugin("modifier","count",function(e,r){if(null===e||"undefined"==typeof e)return 0;if(e.constructor!==Array&&e.constructor!==Object)return 1;r=Boolean(r);var t,a=0;for(t in e)e.hasOwnProperty(t)&&(a++,r&&e[t]&&(e[t].constructor===Array||e[t].constructor===Object)&&(a+=modifiers.count(e[t],!0)));return a}),jSmart.prototype.registerPlugin("modifier","count_characters",function(e,r){return r?e.length:e.replace(/\s/g,"").length}),jSmart.prototype.registerPlugin("modifier","count_paragraphs",function(e){var r=e.match(/\n+/g);return r?r.length+1:1}),jSmart.prototype.registerPlugin("modifier","count_sentences",function(e){var r=e.match(/[^\s]\.(?!\w)/g);return r?r.length:0}),jSmart.prototype.registerPlugin("modifier","count_words",function(e){var r=e.match(/\w+/g);return r?r.length:0}),jSmart.prototype.registerPlugin("modifier","date_format",function(e,r,t){return jSmart.prototype.PHPJS("strftime","date_format").strftime(r?r:"%b %e, %Y",jSmart.prototype.makeTimeStamp(e?e:t))}),jSmart.prototype.registerPlugin("modifier","defaultValue",function(e,r){return void 0==e||""===e||"array"==typeof e&&0==e.length?void 0==r||""===r||"array"==typeof r&&0==e.length?"":r.toString():e.toString()}),jSmart.prototype.registerPlugin("modifier","unescape",function(e,r,t){switch(e=new String(e),r=r||"html",t=t||"UTF-8",r){case"html":return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#039;/g,"'").replace(/&quot;/g,'"');case"entity":case"htmlall":return jSmart.prototype.PHPJS("html_entity_decode","unescape").html_entity_decode(e,t);case"url":return jSmart.prototype.PHPJS("rawurldecode","unescape").rawurldecode(e)}return e}),jSmart.prototype.registerPlugin("modifier","escape",function(e,r,t,a){switch(e=new String(e),r=r||"html",t=t||"UTF-8",a="undefined"!=typeof a?Boolean(a):!0,r){case"html":return a&&(e=e.replace(/&/g,"&amp;")),e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;");case"htmlall":return jSmart.prototype.PHPJS("htmlentities","escape").htmlentities(e,3,t);case"url":return jSmart.prototype.PHPJS("rawurlencode","escape").rawurlencode(e);case"urlpathinfo":return jSmart.prototype.PHPJS("rawurlencode","escape").rawurlencode(e).replace(/%2F/g,"/");case"quotes":return e.replace(/(^|[^\\])'/g,"$1\\'");case"hex":for(var n="",s=0;s<e.length;++s)n+="%"+jSmart.prototype.PHPJS("bin2hex","escape").bin2hex(e.substr(s,1));return n;case"hexentity":for(var n="",s=0;s<e.length;++s)n+="&#x"+jSmart.prototype.PHPJS("bin2hex","escape").bin2hex(e.substr(s,1)).toUpperCase()+";";return n;case"decentity":for(var n="",s=0;s<e.length;++s)n+="&#"+jSmart.prototype.PHPJS("ord","escape").ord(e.substr(s,1))+";";return n;case"mail":return e.replace(/@/g," [AT] ").replace(/[.]/g," [DOT] ");case"nonstd":for(var n="",s=0;s<e.length;++s){var i=jSmart.prototype.PHPJS("ord","escape").ord(e.substr(s,1));n+=i>=126?"&#"+i+";":e.substr(s,1)}return n;case"javascript":return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/<\//g,"</");case"none":return e}return e}),jSmart.prototype.registerPlugin("modifier","indent",function(e,r,t){r=r?r:4,t=t?t:" ";for(var a="";r--;)a+=t;var n=e.match(/\n+$/);return a+e.replace(/\n+$/,"").replace(/\n/g,"\n"+a)+(n?n[0]:"")}),jSmart.prototype.registerPlugin("modifier","lower",function(e){return e.toLowerCase()}),jSmart.prototype.registerPlugin("modifier","nl2br",function(e){return e.replace(/\n/g,"<br />\n")}),jSmart.prototype.registerPlugin("modifier","regex_replace",function(e,r,t){var a=r.match(/^ *\/(.*)\/(.*) *$/);return new String(e).replace(new RegExp(a[1],"g"+(a.length>1?a[2]:"")),t)}),jSmart.prototype.registerPlugin("modifier","replace",function(e,r,t){if(!r)return e;e=new String(e),r=new String(r),t=new String(t);var a="",n=-1;for(n=e.indexOf(r);n>=0;n=e.indexOf(r))a+=e.slice(0,n)+t,n+=r.length,e=e.slice(n);return a+e}),jSmart.prototype.registerPlugin("modifier","spacify",function(e,r){return r||(r=" "),e.replace(/(\n|.)(?!$)/g,"$1"+r)}),jSmart.prototype.registerPlugin("modifier","noprint",function(){return""}),jSmart.prototype.registerPlugin("modifier","string_format",function(e,r){return jSmart.prototype.PHPJS("sprintf","string_format").sprintf(r,e)}),jSmart.prototype.registerPlugin("modifier","strip",function(e,r){return r=r?r:" ",new String(e).replace(/[\s]+/g,r)}),jSmart.prototype.registerPlugin("modifier","strip_tags",function(e,r){return r=null==r?!0:r,new String(e).replace(/<[^>]*?>/g,r?" ":"")}),jSmart.prototype.registerPlugin("modifier","truncate",function(e,r,t,a,n){return r=r?r:80,t=null!=t?t:"...",e.length<=r?e:(r-=Math.min(r,t.length),n?e.slice(0,Math.floor(r/2))+t+e.slice(e.length-Math.floor(r/2)):(a||(e=e.slice(0,r+1).replace(/\s+?(\S+)?$/,"")),e.slice(0,r)+t))}),jSmart.prototype.registerPlugin("modifier","upper",function(e){return e.toUpperCase()}),jSmart.prototype.registerPlugin("modifier","wordwrap",function(e,r,t,a){r=r||80,t=t||"\n";for(var n=e.split("\n"),s=0;s<n.length;++s){for(var i=n[s],o="";i.length>r;){for(var p=0,l=i.slice(p).match(/\s+/);l&&p+l.index<=r;l=i.slice(p).match(/\s+/))p+=l.index+l[0].length;p=p||(a?r:l?l.index+l[0].length:i.length),o+=i.slice(0,p).replace(/\s+$/,""),p<i.length&&(o+=t),i=i.slice(p)}n[s]=o+i}return n.join("\n")}),String.prototype.fetch=function(e){var r=new jSmart(this);return r.fetch(e)},jSmart.prototype.PHPJS=PHP_JS,jSmart.prototype.baiekDebug=jSmart.prototype.baiekDebug||function(e){if(!jSmart.prototype.debugging)return!1;switch(e=e||""){case"modifier":console&&console.log(modifiers);break;case"function":case"block":case"":case"all":var r={},t={};for(var a in plugins)"function"===plugins[a].type?r[a]=plugins[a].process:"block"===plugins[a].type&&(t[a]=plugins[a].process);""===e||"all"===e?console&&console.log({modifiers:modifiers,functions:r,blocks:t}):"function"===e?console&&console.log(r):"block"===e&&console&&console.log(t);break;default:console&&console.error("jsmart的baikeDebug参数：[modifier|function|block|all]")}};var httpsTransMap={"http://baike.baidu.com":"https://baike.baidu.com","http://wapbaike.baidu.com":"https://wapbaike.baidu.com","http://baike.bdimg.com":"https://bkssl.bdimg.com","http://baikebcs.bdimg.com":"https://baikebcs.bdimg.com","http://hiphotos.baidu.com":"https://imgsa.baidu.com","http://imgsrc.baidu.com":"https://imgsa.baidu.com","http://a.hiphotos.baidu.com":"https://imgsa.baidu.com","http://b.hiphotos.baidu.com":"https://imgsa.baidu.com","http://c.hiphotos.baidu.com":"https://imgsa.baidu.com","http://d.hiphotos.baidu.com":"https://imgsa.baidu.com","http://e.hiphotos.baidu.com":"https://imgsa.baidu.com","http://f.hiphotos.baidu.com":"https://imgsa.baidu.com","http://g.hiphotos.baidu.com":"https://imgsa.baidu.com","http://h.hiphotos.baidu.com":"https://imgsa.baidu.com","http://cdn00.baidu-img.cn":"https://timg01.bdimg.com","http://m.baidu.com":"https://m.baidu.com","http://drm.media.baidubce.com":"https://drm.media.baidubce.com","http://bs.baidu.com":"https://baikebcs.bdimg.com","http://passport.baidu.com":"https://passport.baidu.com","http://wappass.baidu.com":"https://wappass.baidu.com","http://jsapi.qq.com":"https://jsapi.qq.com","http://img.baidu.com":"https://gss0.baidu.com/70cFsjip0QIZ8tyhnq","http://himg.baidu.com":"https://gss0.baidu.com/7Ls0a8Sm2Q5IlBGlnYG","http://himg.bdimg.com":"https://gss0.bdstatic.com/7Ls0a8Sm1A5BphGlnYG","http://tts.baidu.com":"https://gss0.baidu.com/6KAZsjip0QIZ8tyhnq","http://zhangmenshiting.baidu.com":"https://gss0.baidu.com/yrwHcj7d1QgTmNK7m9_UKT6zgBYnreHg-_","http://nssug.baidu.com":"https://gsp0.baidu.com/8qUZeT8a2gU2pMbgoY3K","http://msg.baidu.com":"https://gsp0.baidu.com/8_UFsjip0QIZ8tyhnq","http://static.tieba.baidu.com":"https://gsp0.baidu.com/5aAHeD3nKhI2p27j8IqW0jdnxx1xbK"};jSmart.prototype.registerPlugin("modifier","wiki_common_https_trans",function(e){return"https:"===window.location.protocol&&(e=e.replace(/http:\/\/[^\/]+/,function(e){return httpsTransMap[e]?httpsTransMap[e]:e})),e}),"undefined"!=typeof module&&module.exports?module.exports=jSmart:window.jSmart=jSmart});